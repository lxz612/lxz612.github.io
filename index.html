<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Noto Sans SC:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Someone‘s Notes">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Someone‘s Notes">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="someone">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Someone‘s Notes</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Someone‘s Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/10/20211110-codetech-kotlin-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Someone‘s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/11/10/20211110-codetech-kotlin-1/" itemprop="url">【笔记】Kotlin —— object 关键字</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-11-10T10:24:47+08:00">
                2021-11-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-对象声明"><a href="#1-对象声明" class="headerlink" title="1. 对象声明"></a>1. 对象声明</h5><p>kotlin 编译器会直接生成一个对象，并且在方法区的运行时常量池中生成该对象的引用，名字叫 INSTANCE。因此这个对象是一个全局单例对象。<br>&nbsp;<br>注：对应 Java，就是声明了一个静态的单例对象。这个对象引用的名字为 INSTANCE。只不过 Kotlin 中把类声明和创建对象结合起来。</p>
<h5 id="2-伴生对象"><a href="#2-伴生对象" class="headerlink" title="2. 伴生对象"></a>2. 伴生对象</h5><p>类中声明的伴生对象实际上就是一个常规对象，只不过这个对象全局唯一的，也是一个单例对象。因此这个对象存放在堆中。该对象的引用则放到了常量池中，引用的名字为：类名.Companion。所以 Kotin 和 Java 都可以通过这个引用拿到这一个全局单例对象。<br>&nbsp;<br>值得注意的是：在 Java 的概念体系中，这个引用称之为一个静态字段。但由于 Kotlin 没有 “静态” 这一概念，所以该引用 kotlin 概念体系中则称之为名字为 “类名.Companion” 的编译器常量（const 修饰的 val）。Java 的静态字段和 Kotlin 的编译器常量均存储在 JVM 方法区的常量池中。<br>&nbsp;<br>但是为了契合 Java 的使用习惯，Kotlin 提供了 @JvmField 和 @JvmStatic 两个注解，使得编译器在生成该对象的同时，也生成了对应的静态变量（常量）和静态方法，以方便在 Java 调用。<br>&nbsp;<br>因此即便不使用这两个注解，Java 也可以通过 “类名.Companion” 的方式获取该对象。<br>&nbsp;</p>
<h5 id="3-对象表达式（声明匿名内部类）"><a href="#3-对象表达式（声明匿名内部类）" class="headerlink" title="3. 对象表达式（声明匿名内部类）"></a>3. 对象表达式（声明匿名内部类）</h5><p>object 声明的匿名内部类并不是单例的。比如，在 Kotlin1.0 中，每个 lambda 表示式都会被编译为一个匿名内部类，除非是一个内联类型的 lambda。</p>
<h5 id="4-拓展：内部类（广义）"><a href="#4-拓展：内部类（广义）" class="headerlink" title="4. 拓展：内部类（广义）"></a>4. 拓展：内部类（广义）</h5><p>当一个类（类 A）被定义在另一个类（类 A 的外部类）中时，类 A 有两种情况：存储持有外部类的引用或者不存储持有外部类的引用。<br>&nbsp;<br>在 Java 概念体系中，类 A 为嵌套类。其中：<br>存储外部类引用的类 A 则为非静态嵌套类，也称内部类。内部类又分为三种：成员内部类、局部内部类（定义在方法中的类，实际开发很少用！）、匿名内部类。<br>不存储外部类引用的类 A 则为静态嵌套类，也称静态内部类。<br>&nbsp;<br>在 Kotlin 概念体系中，概念分类较为简单。不存储外部类引用的类 A 直接称为嵌套类，存储外部类引用的类 A 称为内部类。其中内部类也分为成员内部类、局部内部类和匿名内部类。<br>&nbsp;<br>注意：</p>
<ul>
<li>Kotlin 中默认声明的嵌套类，内部类（成员内部类）需要特别用 inner 关键字标识。</li>
<li>在 Java8 中，虽然函数式接口的匿名内部类与 lambda 表达式在功能上是等价的，但后者并不是前者的简写模式，因为两者的在 JVM 中实现原理不一样。“new + 接口名” 声明的匿名内部类，编译时会生成一个额外的 class 文件；而 lambda 表达式则不会生成该文件，而是在编译时被封装为主类的一个私有方法，可通过 invokedynamic 指令进行调用。因此 lambda 表达式的 this 指向的是外部的作用域。</li>
<li>在 Kotlin1.0 中，为了兼容 Java 8 之前的版本，每个 lambda 表示式都会被编译为一个匿名类，除非是一个内联的 lambda。不过在 kotlin 1.1 版本，已经支持生成 Java 8 字节码。<br>&nbsp;</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/24/20211024-android-guifenceng/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Someone‘s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/10/24/20211024-android-guifenceng/" itemprop="url">【笔记】Android GUI 系统分层</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-24T20:24:47+08:00">
                2021-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Android GUI 系统的层次如下图所示：<br>&nbsp;<br><img src="evernotecid://FDAA17D6-E5AA-40B2-8D31-AAAB4BE1E3D2/appyinxiangcom/11416218/ENResource/p9" alt="a1ca1488c1e207d798b530430361bb39.png">@w=400<br><em>From 《深入理解 Android 内核设计思想》</em></p>
<h5 id="1-显示驱动"><a href="#1-显示驱动" class="headerlink" title="1. 显示驱动"></a>1. 显示驱动</h5><p>Linux 内核提供统一的 framebuffer（帧缓冲区）显示驱动。设备节点是 /dev/graphics/fb* 或 /dev/fb* ，其中 fb0 表示第一个 Monitor，即系统实现只用到了一个显示屏。</p>
<h5 id="2-HAL"><a href="#2-HAL" class="headerlink" title="2. HAL"></a>2. HAL</h5><p>Android 抽象了 HAL 接口提供给硬件厂商。不同的硬件只要根据 HAL 接口提供不同的驱动程序即可。HAL 定义了两个设备：Gralloc 和 fb。</p>
<ul>
<li>fb：负责打开内核中的 framebuffer。</li>
<li>Gralloc：用于管理 framebuffer 的分配和释放。</li>
</ul>
<h5 id="3-本地窗口：FramebufferNativeWindow-和-Surface"><a href="#3-本地窗口：FramebufferNativeWindow-和-Surface" class="headerlink" title="3. 本地窗口：FramebufferNativeWindow 和 Surface"></a>3. 本地窗口：FramebufferNativeWindow 和 Surface</h5><p>OpenGL ES 与平台无关，所以需要抽象了本地窗口的概念。不同的平台需要提供一个本地窗口给 OpenGL ES 绘制。在 Android 中，提供了两种本地窗口：面向 SurfaceFlinger 的 FramebufferNativeWindow + 面向应用程序的 Surface（Native 层）。<br>&nbsp;<br>FramebufferNativeWindow 使用了帧缓冲区，能够直接显示在屏幕上；而 Surface 使用了内存缓冲区。不同的应用程序拥有不同的 UI 窗口，每一种 UI 窗口对应了一个 Surface。为了是这些窗口能够按序展示出来，SurfaceFinger 的职责就是对这些 Surface 进行统一的图像混合操作，然后输出到自己的，直接面向屏幕的本地窗口上。如下图：<br>&nbsp;<br><img src="evernotecid://FDAA17D6-E5AA-40B2-8D31-AAAB4BE1E3D2/appyinxiangcom/11416218/ENResource/p10" alt="fcaad8bed95245ab5ab4ac3fa0baa5f5.png">@w=400<br><em>From 《深入理解 Android 内核设计思想》</em><br>&nbsp;<br>因此 FramebufferNativeWindow（Window-1） 与 Surface（Window-2）都继承自 ANativeWindow。另外，在具体实现中，本地窗口 Surface 的绘图库实际上可以由其他图形库实现，如 Skia。Android 同时提供了 Skia（Canvas 软件渲染，但从 Android 8.0 开始， Skia 也可以开启硬件渲染模式，将 Canvas 的绘图操作直接转换为对 OpenGL ES 或者 Vulkan 调用）和 OpenGL ES（硬件渲染） 两种实现。**Java 层的 Surface 则是对本地窗口 Surface 的封装 **。</p>
<h5 id="4-OpenGL-ES-与-EGL"><a href="#4-OpenGL-ES-与-EGL" class="headerlink" title="4. OpenGL ES 与 EGL"></a>4. OpenGL ES 与 EGL</h5><p>OpenGL ES 是一个适用于嵌入式设备的通用图形函数库。上层程序通过其提供的绘图 API 来在本地窗口绘制内容。而其中 EGL 的职责就是 OpenGL ES 配置本地窗口。事实上，EGL 是与本地窗口系统之间的一个接口层，是沟通二者的桥梁。<br><img src="evernotecid://FDAA17D6-E5AA-40B2-8D31-AAAB4BE1E3D2/appyinxiangcom/11416218/ENResource/p11" alt="05ed87ae4a3284c13bc89f5a823822d7.png">@w=400<br><em>From <a target="_blank" rel="noopener" href="https://juejin.cn/post/6877071747145793543">https://juejin.cn/post/6877071747145793543</a></em></p>
<h5 id="5-SurfaceFlinger"><a href="#5-SurfaceFlinger" class="headerlink" title="5. SurfaceFlinger"></a>5. SurfaceFlinger</h5><p>SurfaceFlinger 职责是按 Z 轴混合所有 Surface 内存缓存区中的图像数据，生成合成图像数据，然后加载进 FramebufferNativeWindow 缓存区中，进而显示在屏幕上。</p>
<blockquote>
<p>无论开发者使用什么渲染 API，一切内容都会渲染到 Surface 上。Surface 表示缓冲区队列中的生产方，而缓冲区队列通常会被 SurfaceFlinger 消耗。在 Android 平台上创建的每个窗口都由 Surface 提供支持。所有被渲染的可见 Surface 都被 SurfaceFlinger 合成到屏幕。<br><em>From <a target="_blank" rel="noopener" href="https://source.android.google.cn/devices/graphics?hl=zh-cn">https://source.android.google.cn/devices/graphics?hl=zh-cn</a></em></p>
</blockquote>
<h5 id="7-理一理"><a href="#7-理一理" class="headerlink" title="7. 理一理"></a>7. 理一理</h5><p>理解源码的难度在于设计者可以从底层开始概念抽象、架构设计以及代码设计，而阅读者一般只能自顶层往下去一层一层的理解设计者的意图。所以有时候阅读代码时，还是需要多站在设计者的角度思考，理解或许可以更透彻些。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/07/20211007-android-ui-viewsystem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Someone‘s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/10/07/20211007-android-ui-viewsystem/" itemprop="url">【笔记】Android 视图体系设计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-10-07T09:24:47+08:00">
                2021-10-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>视图体系有三个抽象层级：顶层是 Activity、Dialog、PopupWindow 等界面视图；中层是 Window 窗口；底层是由 ViewRootImpl 管理的 View 树。</p>
<h5 id="底层设计"><a href="#底层设计" class="headerlink" title="底层设计"></a>底层设计</h5><ol>
<li><p>概念设计<br>底层的 View 是对文本、图片、按钮等 UI 元素的抽象，ViewGroup 是对容纳 UI 元素的 UI 布局的抽象。UI 基础布局是一类特殊的 UI 元素，因此 ViewGroup 继承自 View。因此，一棵 View 树就是对 UI 元素相互嵌套组成整体 UI 视图的抽象。</p>
</li>
<li><p>细节设计<br>对于 Activity 的 UI 视图来说，它的 View 树的根为 mDecor（DecorView），其中包括状态栏背景 statusBarBackground（View）、导航栏背景 navigationBarBackground（View）、以及 mContentParent（ViewGroup）。其中 mContentParent 又具体包含为标题栏（可无）和内容（setContentView）</p>
</li>
<li><p>相关类和方法<br><code>DecorView.java</code><br><code>View.java</code><br><code>ViewGroup.java</code></p>
</li>
</ol>
<h5 id="中层设计"><a href="#中层设计" class="headerlink" title="中层设计"></a>中层设计</h5><ol>
<li>概念设计<br>Window，顾名思义，是对窗口这一概念的抽象。窗口拥有着一棵 View 树，并且需要具备管理这棵视图树的能力，如树的创建与初始化，设置树的内容，查找树的结点。</li>
</ol>
<ol start="2">
<li>细节设计<br>Android 设计了一个 Window 接口，定义了窗口需要具备的行为。且给出了一个具体的实现类 PhoneWindow。另外还设计了 WindowManager 的角色，来具体管理窗口，其中最重要就是对 View 树的管理。因此 WindowManager 继承了 ViewManager。ViewManager 很简单，只有三个方法，分别是对树的增加、更新以及删除。WindowManager 是一个接口，具体实现类为 WindowManagerImpl。<br>&nbsp;<br>但是 WMI 也只是个躯壳，实际的 View 树的增删改功能被委托给 WindowManagerGlobal 这个类。WMG 采用了单例模式。因此所有 Window 的 View 树都被交给它来管理。从 WMG 的 <code>addView ()</code> 中可以看到 WMG 为每一个 View 树都创建了一个 ViewRootImpl。因此这个 ViewRootImpl 才是最终打理整个 View 树的人。</li>
</ol>
<ol start="3">
<li>相关类和方法<br><code>Window.java</code><br><code>PhoneWindow.java</code><br><code>WindowManager.java</code><br><code>ViewManager.java</code><br><code>WindowManagerImpl.java</code><br><code>WindowManagerGloal.java</code><br><code>ViewRootImpl.java</code></li>
</ol>
<h5 id="顶层设计"><a href="#顶层设计" class="headerlink" title="顶层设计"></a>顶层设计</h5><ol>
<li><p>概念设计<br>界面，则是屏幕视图的抽象。最常用就是 Activity 和 Dialog。之前会疑惑为什么不把对话框作为为 View 树的一部分，而是设计为同 Activity 同一层级的界面级组件，Dialog 对话框也是一种基础 UI 元素呀？现在一想，或许是因为从视觉角度出发，Dialog 对话框总是显示在屏幕的中央，实际上可以看作没占满全屏的 Activity。 </p>
</li>
<li><p>细节设计<br>Activity、Dialog 等界面级组件持有一个窗口，但不参与窗口以及窗口下面 View 树视图管理。它们更重要的职责是对屏幕界面级行为的抽象，比如抽象出生命周期的概念。</p>
</li>
<li><p>相关类与方法<br><code>Activity.java</code><br><code>Dialog.java</code><br><code>PopupWindow.java</code></p>
</li>
</ol>
<h5 id="理一理"><a href="#理一理" class="headerlink" title="理一理"></a>理一理</h5><p>主要梳理对象的数量关系：一个 Activity 拥有一个 Window 窗口（Activity 拥有一个 mWindow 的成员变量），每一个 Window 则对应着一棵 View 树（Window 内部拥有一个 mDecor 成员变量）以及一个管理这棵树的 ViewRootImpl。因此每一个 Window 都拥有一个 WM 以及 WMI。而 WMG 则是一个 App 只有一个，负责管理全部 Activity 以及 Dialog 对应 Window 以及 View 树！ </p>
<h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><ol>
<li>《深入理解 Android 内核设计思想》</li>
<li>《深入理解 Android：卷一》</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/22/20210922-android-ui-shadow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Someone‘s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/22/20210922-android-ui-shadow/" itemprop="url">【笔记】阴影</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-22T20:24:47+08:00">
                2021-09-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="有几种阴影？"><a href="#有几种阴影？" class="headerlink" title="有几种阴影？"></a>有几种阴影？</h4><p>阴影分为两种：外阴影（也称投影、drop shadow）和内阴影。外阴影的作用是使 UI 组件有悬浮的效果，而内阴影会使 UI 组件产生往内陷的视觉效果。内阴影一般不常用。因此下面讨论的均针对外阴影。</p>
<h4 id="如何设计外阴影？"><a href="#如何设计外阴影？" class="headerlink" title="如何设计外阴影？"></a>如何设计外阴影？</h4><p>以 Figma 为例。除了阴影颜色，Figma 提供 UI 设计师了 4 个属性来控制 UI 组件的阴影，分别是 x，y，blur 和 spread。x 和 y 分别控制水平方向和垂直方向的偏移量；blur 控制阴影边缘的模糊程度，数值在 0 到 250 之间：blur 数值越大，边缘越模糊，反之越锐利；spread 控制阴影的大小：spread 越大，阴影面积越大，反之越小。</p>
<p>由于 Android UI 体系提供控制阴影的属性在概念上没有和 Figma 等 UI 设计软件保持一致，因此阴影实现总是成为开发同学和设计同学 battle 的永恒话题。</p>
<h4 id="如何实现阴影？"><a href="#如何实现阴影？" class="headerlink" title="如何实现阴影？"></a>如何实现阴影？</h4><p> Material Design 是谷歌官方的设计语言，简洁倒是简洁，好看也算好看，但体现不了设计同学的价值，因此并不受人待见。MD 定义了 Z 轴的概念，即屏幕内所有 UI 组件都有一个视觉高度 Elevation。Elevation 的值越大，表明其悬浮高度越高，View 底部阴影就越明显。</p>
<p>Elevation 的实现方式有以下两种：</p>
<ol>
<li><p>设置 View 的 elevation 属性</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置阴影大小（Android API21 以上）</span></span><br><span class="line">view.elevation = <span class="number">5</span> <span class="comment">// 代码 </span></span><br><span class="line">android:elevation=<span class="string">&quot;5dp&quot;</span> <span class="comment">//xml 文件 </span></span><br></pre></td></tr></table></figure>
<p>此外，还可以设置阴影颜色。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置阴影颜色 （Android API28 以上）</span></span><br><span class="line">android:outlineAmbientShadowColor=<span class="string">&quot;#e5353e&quot;</span></span><br><span class="line">android:outlineSpotShadowColor=<span class="string">&quot;#e5353e&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>MaterialShapeDrawable<br>MaterialShapeDrawable 是 Google 提供的实现 MD 风格 shape 的类。需要注意：因为 Elevation 的阴影是由父布局绘制的，因此需要设置 <code>android:clipChildren=&quot;false&quot;</code> 才可以生效。<br>&nbsp;<br>Elevation 出现之后，就成为了实现阴影最简便的方式。它的优点很明显：一实现简单；二实现的是 fake shadow，不占地方。缺点也很明显：一是 Elevation 仅能实现 blur 属性的效果，因此无法控制阴影的大小（spread）；二是无法采用透明度颜色：因为 Elevation 本质就是采用颜色的透明度来设置阴影边缘渐变效果 —— 从 28% 不透明度到 0% 不透明度。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">findViewById&lt;TextView&gt;(R.id.tvShadow).background = MaterialShapeDrawable ().apply &#123;</span><br><span class="line">    setTint (Color.parseColor (<span class="string">&quot;#44bebebe&quot;</span>)) <span class="comment">// 背景颜色 </span></span><br><span class="line">    paintStyle = Paint.Style.FILL <span class="comment">// 填充类型 </span></span><br><span class="line">    shadowCompatibilityMode = MaterialShapeDrawable.SHADOW_COMPAT_MODE_ALWAYS <span class="comment">//fake shadow 模式 </span></span><br><span class="line">    initializeElevationOverlay (<span class="keyword">this</span><span class="symbol">@MainActivity</span>)</span><br><span class="line">    setShadowColor (Color.parseColor (<span class="string">&quot;#e5353e&quot;</span>)) <span class="comment">// 阴影颜色 透明度从 28%~0% 渐变 </span></span><br><span class="line">    elevation = <span class="number">25f</span> <span class="comment">// 视觉高度 </span></span><br><span class="line">    shadowVerticalOffset = <span class="number">10</span> <span class="comment">// 垂直偏移量 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>paint.setShadowLayer ()<br>自定义 Drawable 中设置画笔 Paint 的 setShadowLayer 方法。这种方式中 shadowRadius 属性比较接近设计软件中的 Blur 属性，并且支持设置带透明度的颜色。但缺点是绘制不是 fake shadow，故而需要占用 View 的背景空间。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//shadowRadius：阴影的模糊程度 </span></span><br><span class="line"><span class="comment">//shadowDx：水平偏移 </span></span><br><span class="line"><span class="comment">//shadowDy：垂直偏移 </span></span><br><span class="line"><span class="comment">//shadowColor：阴影颜色 </span></span><br><span class="line">paint.setShadowLayer (shadowRadius, shadowDx, shadowDy, shadowColor);</span><br></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/22/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Someone‘s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/22/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-22T19:33:12+08:00">
                2021-09-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">someone</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
